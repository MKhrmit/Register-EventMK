<!DOCTYPE html>
<html lang="th">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ระบบลงทะเบียนพนักงาน</title>
    <!-- ลิงก์ไปยังไลบรารี SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link href='https://fonts.googleapis.com/css?family=Prompt' rel='stylesheet' type='text/css'>
    <!-- เพิ่มส่วนหัว SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
   <!-- เพิ่มลิงก์ไปยังไลบรารี SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script> <!-- นำเข้า SweetAlert2 -->


    <style>

     body {
    background-image: url('https://drive.google.com/uc?id=1E09zUiAFo8-8vg0uzXLMrToG20hjLeoO');
    background-size: cover;
    background-repeat: no-repeat;
    background-attachment: fixed;
    font-family: 'Prompt', sans-serif;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    color: black;
}

.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: rgba(242, 242, 242, 0.8);
    padding: 20px;
    border-radius: 5px;
    margin: 20px auto;
    max-width: 600px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}

.form-group {
    background-color: rgba(242, 242, 242, 0.8);
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 20px;
}

.employee-info {
    background-color: rgba(242, 242, 242, 0.8);
    padding: 10px;
    border-radius: 5px;
    margin-top: 20px;
}

/* เพิ่มส่วนที่คุณให้มาแล้ว */
/* CSS เพื่อล็อคขนาดหน้าจอ */
html, body {
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 0;
}

/* label {
    display: block;
    font-weight: bold;
    margin-bottom: 1px;
   
} */

input[type="text"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 3px;
    resize: none;
}

button {
    font-family: 'Prompt', sans-serif;
    background-color: #d32f2f;
    color: gold;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 3px;
}

button:hover {
    background-color: #b71c1c;
}

#loading {
    text-align: center;
    display: none;
}

#loading img {
    width: 50px;
    height: 50px;
    margin: 20px auto;
}

/* สไตล์ของ Spinner การค้นหาข้อมูล */
#loading img {
    width: 100px;
    height: 40px;
}

#loadingText {
    font-size: 16px;
}

/* สไตล์ของ Spinner การลงทะเบียน */
#loadingRegister img {
    width: 150px;
    height: 40px;
}

#loadingTextRegister {
    font-size: 16px;
}

/* CSS เพื่อทำให้ฟิลด์เป็นสีเทา */
.readonly-field {
    background-color: #f2f2f2;
    color: #666;
}


/* CSS สำหรับตาราง */
    table {
        font-size: 14px;
        text-align: left;
        width: 100%;
        max-width: 600px;
    }

    /* CSS สำหรับเซลล์ของตาราง */
    table td {
        white-space: nowrap;
    }
</style>

</head>
<div class="container" style="background-color: #f2f2f2; padding: 50px; border-radius: 5px;">
  <br>
  <br>
  <br>
    <img src="https://drive.google.com/uc?id=1cLpJdPQLYR9PBLVN0306nopLgq-Z1KNM" alt="โลโก้" style="width: 100%; max-width: 150px; height: auto;">
    <h2>ลงทะเบียนเข้าร่วมงาน "ร้อยร้าน ล้านรัก"</h2>
    <h3>งานเชิดชูเกียรติพนักงานปฏิบัติงานครบ 10 ปี 20 ปี 30 ปี</h3>

    <!-- กรอบส่วนที่ 1: รหัสพนักงาน -->
    <div class="form-group">
        <label for="employeeCode">รหัสพนักงาน (7 หลัก):</label>
        <input type="text" id="employeeCode" required oninput="formatEmployeeCode(this)" placeholder="พิมพ์รหัสพนักงาน 7 หลักแล้วกดค้นหา">
        <button type="button" onclick="searchAndFill()">ค้นหา</button>
    </div>
    

    <!-- Spinner การค้นหา -->
    <div id="loading" style="display: none;">
        <img src="https://media4.giphy.com/media/qaPLw3LAAYsB08y4oZ/giphy.gif?cid=ecf05e47g9226pn33k9atlvpida6ed70ovkuhnqr91qgzvgd&ep=v1_stickers_search&rid=giphy.gif&ct=s" alt="กำลังค้นหาข้อมูล...">
        <p id="loadingText">กำลังค้นหาข้อมูล...</p>
    </div>

    <!-- Spinner การลงทะเบียน -->
    <div id="loadingRegister" style="display: none;">
        <img src="https://media3.giphy.com/media/ZevADxsOcjO1PEETLQ/giphy.gif?cid=ecf05e47tq07jumpo5gvjqf434v1ji8pz97g5i57obe2x57v&ep=v1_gifs_related&rid=giphy.gif&ct=s" alt="กำลังบันทึกข้อมูล...">
        <p id="loadingTextRegister">กำลังบันทึกข้อมูล...</p>
    </div>

    <!-- กรอบส่วนที่ 2: ข้อมูลพนักงาน -->
    <div class="employee-info">
        <h2>ข้อมูลพนักงาน</h2>
        <label for="name">ชื่อ-นามสกุล:</label>
        <input type="text" id="name" readonly class="readonly-field">
        
        <label for="department">หน่วยงานสาขา:</label>
        <input type="text" id="department" readonly class="readonly-field">
        
        <label for="phoneNumber">ประเภทพนักงาน:</label>
        <input type="text" id="phoneNumber" readonly class="readonly-field">
        
        <label for="yearsOfWork">กลุ่ม:</label>
        <input type="text" id="yearsOfWork" readonly class="readonly-field">
        <button type="button" onclick="registerEmployee()">ลงทะเบียน</button>
    </div>
</div>

</div>
<script>
// ฟังก์ชันสำหรับลงทะเบียนพนักงาน
// ...

// ฟังก์ชันสำหรับลงทะเบียนพนักงาน
function registerEmployee() {
    var employeeCode = document.getElementById('employeeCode').value;
    var name = document.getElementById('name').value;
    var department = document.getElementById('department').value;
    var phoneNumber = document.getElementById('phoneNumber').value;
    var yearsOfWork = document.getElementById('yearsOfWork').value;

    // แสดง Spinner ก่อนบันทึกข้อมูล
    document.getElementById('loadingRegister').style.display = 'block';

    // ตรวจสอบว่ารหัสพนักงานมี 7 หลักหรือไม่
    if (employeeCode.length !== 7 || isNaN(employeeCode)) {
        Swal.fire({
            icon: 'error',
            title: 'ผิดพลาด',
            text: 'กรุณากรอกรหัสพนักงานที่มี 7 หลักและเป็นตัวเลขเท่านั้น',
            confirmButtonText: 'ตกลง'
        });
        return;
    }

    // ตรวจสอบข้อมูลในฟิลด์ทุก field ว่ามีข้อมูลหรือไม่
    if (!name || !department || !phoneNumber || !yearsOfWork) {
        Swal.fire({
            icon: 'error',
            title: 'ผิดพลาด',
            text: 'กรุณากรอกข้อมูลให้ครบทุกช่อง',
            confirmButtonText: 'ตกลง'
        });
        return;
    }

    // เรียก Google Apps Script เพื่อตรวจสอบรหัสพนักงานและข้อมูลในฟิลด์
    google.script.run.withSuccessHandler(function (isEmployeeCodeExists) {
        if (!isEmployeeCodeExists) {
            Swal.fire({
                icon: 'error',
                title: 'ไม่พบรหัสพนักงาน',
                text: 'ไม่พบรหัสพนักงานนี้ในระบบ',
                confirmButtonText: 'ตกลง'
            }).then(function () {
                // รีเซ็ตค่าในฟิลด์ทั้งหมด

                document.getElementById('name').value = '';
                document.getElementById('department').value = '';
                document.getElementById('phoneNumber').value = '';
                document.getElementById('yearsOfWork').value = '';
            });

            // แสดง Spinner ก่อนแสดง Sweet Alert
            document.getElementById('loadingRegister').style.display = 'none';
            return;
        }

        google.script.run.withSuccessHandler(function (result) {
  if (result.isDuplicate) {
    Swal.fire({
      icon: 'warning',
      title: 'ไม่สำเร็จ คุณเคยลงทะเบียนแล้ว',
      
      confirmButtonText: 'ตกลง',
      text: 'รายชื่อนี้มีอยู่แล้วในระบบ',
      html: `
        <table id="table" class="table table-striped" style="font-size: 14px; text-align: left; width: 100%; max-width: 600px;">
  <tr>
    <th colspan="2" style="font-size: 18px;">ข้อมูลการลงทะเบียนของคุณ</th>
  </tr>
  <tr>
    <th style="text-align: left;">ชื่อ-นามสกุล :</th>
    <td>${result.employeeData.name}</td>
  </tr>
  <tr>
    <th style="text-align: left;">หน่วยงานสาขา :</th>
    <td>${result.employeeData.department}</td>
  </tr>
  <tr>
    <th style="text-align: left;">ประเภทพนักงาน :</th>
    <td>${result.employeeData.phoneNumber}</td>
  </tr>
  <tr>
    <th style="text-align: left;">กลุ่ม :</th>
    <td>${result.employeeData.yearsOfWork}</td>
  </tr>
  <tr>
    <th style="text-align: left; font-size: 16px; font-weight: bold;">ที่นั่ง :</th>
    <td style="font-size: 22px; font-weight: bold;">${result.employeeData.seatNumber}</td>
  </tr>
</table>

      `
    }).then(function () {
      // รีเซ็ตค่าในฟิลด์ทั้งหมด
      document.getElementById('employeeCode').value = '';
      document.getElementById('name').value = '';
      document.getElementById('department').value = '';
      document.getElementById('phoneNumber').value = '';
      document.getElementById('yearsOfWork').value = '';
    });


                // แสดง Spinner ก่อนแสดง Sweet Alert
                document.getElementById('loadingRegister').style.display = 'none';
            } else {
                // เรียก Google Apps Script เพื่อดึงเลขที่นั่งที่ว่าง
                google.script.run.withSuccessHandler(function (seatNumber) {
                    if (!seatNumber) {
                        Swal.fire({
                            icon: 'error',
                            title: 'ไม่พบที่นั่งว่าง',
                            text: 'ขออภัย ไม่มีที่นั่งว่างในขณะนี้',
                            confirmButtonText: 'ตกลง'
                        }).then(function () {
                            // รีเซ็ตค่าในฟิลด์ทั้งหมด
                            document.getElementById('employeeCode').value = '';
                            document.getElementById('name').value = '';
                            document.getElementById('department').value = '';
                            document.getElementById('phoneNumber').value = '';
                            document.getElementById('yearsOfWork').value = '';
                        });

                        // แสดง Spinner ก่อนแสดง Sweet Alert
                        document.getElementById('loadingRegister').style.display = 'none';
                        return;
                    }

                    // รอเวลา 5 วินาที (5000 มิลลิวินาที) ก่อนที่จะบันทึกข้อมูล
                    setTimeout(function () {
                        // เรียก Google Apps Script เพื่อลงทะเบียนพนักงาน
                        google.script.run.withSuccessHandler(function () {
                            // แสดง Spinner ก่อนแสดง Sweet Alert
                            document.getElementById('loadingRegister').style.display = 'none';

                            // แสดง SweetAlert เมื่อบันทึกสำเร็จ
                            Swal.fire({
                                icon: 'success',
                                title: 'ลงทะเบียนสำเร็จ!',
                                html: `<table id="table" class="table table-striped" style="font-size: 14px; text-align: left; width: 100%; max-width: 600px;">
                                    <tr>
                                        <th style="text-align: left;">รหัสพนักงาน :</th>
                                        <td>${employeeCode}</td>
                                    </tr>
                                    <tr>
                                        <th style="text-align: left;">ชื่อ-นามสกุล :</th>
                                        <td>${name}</td>
                                    </tr>
                                    <tr>
                                        <th style="text-align: left;">หน่วยงานสาขา :</th>
                                        <td>${department}</td>
                                    </tr>
                                    <tr>
                                        <th style="text-align: left;">ประเภทพนักงาน :</th>
                                        <td>${phoneNumber}</td>
                                    </tr>
                                    <tr>
                                        <th style="text-align: left;">กลุ่ม :</th>
                                        <td>${yearsOfWork}</td>
                                    </tr>
                                    <tr>
                                        <th style="text-align: left; font-size: 16px; font-weight: bold;">ที่นั่ง :</th>
                                        <td style="font-size: 22px; font-weight: bold;">${seatNumber}</td>
                                    </tr>
                                </table>`,
                                confirmButtonText: 'ตกลง'
                            }).then(function () {
                                // รีเซ็ตค่าในฟิลด์ทั้งหมด
                                document.getElementById('employeeCode').value = '';
                                document.getElementById('name').value = '';
                                document.getElementById('department').value = '';
                                document.getElementById('phoneNumber').value = '';
                                document.getElementById('yearsOfWork').value = '';
                                // รีเซ็ตค่าฟิลด์ค้นหา
                                document.getElementById('employeeCode').value = '';
                            });
                        }).registerEmployee(employeeCode, name, department, phoneNumber, yearsOfWork, seatNumber);
                    }, 5000); // รอเวลา 5 วินาที (5000 มิลลิวินาที)
                }).getAvailableSeat();
            }
        }).checkDuplicate(employeeCode);
    }).checkEmployeeCodeInListData(employeeCode); // เรียกใช้ checkEmployeeCodeInListData เพื่อตรวจสอบว่ารหัสพนักงานมีอยู่ใน List data
}

// ...


// ฟังก์ชันสำหรับจัดรูปแบบรหัสพนักงาน
function formatEmployeeCode(input) {
    var employeeCode = input.value;
    if (employeeCode.length < 7) {
        return;
    }

    // เพิ่ม "00" ข้างหน้าและใช้ Right เพื่อตัดเหลือ 7 ตัว
    var formattedEmployeeCode = '00' + employeeCode;
    formattedEmployeeCode = formattedEmployeeCode.slice(-7);

    input.value = formattedEmployeeCode;
}

// ฟังก์ชันสำหรับค้นหาและเติมข้อมูล
function searchAndFill() {
    var employeeCode = document.getElementById('employeeCode').value;

    // ตรวจสอบว่ารหัสพนักงานมี 7 หลักหรือไม่
    if (employeeCode.length !== 7 || isNaN(employeeCode)) {
        Swal.fire({
            icon: 'error',
            title: 'ผิดพลาด',
            text: 'กรุณากรอกรหัสพนักงานที่มี 7 หลักและเป็นตัวเลขเท่านั้น',
            confirmButtonText: 'ตกลง'
        });
        return;
    }

    // แสดง Spinner ก่อนเรียกใช้ Google Apps Script สำหรับการค้นหา
    document.getElementById('loading').style.display = 'block';

    // เรียกใช้ Google Apps Script เพื่อดึงข้อมูลพนักงาน
    google.script.run.withSuccessHandler(function (employeeInfo) {
        // ซ่อน Spinner หลังจากโหลดข้อมูลเสร็จสมบูรณ์
        document.getElementById('loading').style.display = 'none';

        if (employeeInfo) {
            document.getElementById('name').value = employeeInfo.name;
            document.getElementById('department').value = employeeInfo.department;
            document.getElementById('phoneNumber').value = employeeInfo.phoneNumber;
            document.getElementById('yearsOfWork').value = employeeInfo.yearsOfWork;
        } else {
            Swal.fire({
                icon: 'error',
                title: 'ไม่พบข้อมูลพนักงาน',
                text: 'ไม่พบข้อมูลพนักงาน',
                confirmButtonText: 'ตกลง'
            });
        }
    }).getDataMedicamentos(employeeCode);
}
</script>



</body>
</html>
